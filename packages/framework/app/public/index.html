<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Drayman Framework</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://unpkg.com/@angular/material@10.1.3/prebuilt-themes/indigo-pink.css">
    <link rel="stylesheet" href="https://unpkg.com/filepond@4.27.1/dist/filepond.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/zone.js@0.8.18/dist/zone.min.js"></script>
    <script src="/drayman-framework-client.js"></script>
</head>

<body>
    <drayman-element component="home"></drayman-element>

    <script>
        initializeDraymanFramework({
            browserCommands: {
                getCurrentUrl: async () => window.location.href,
            },
            // eventOptions: { debounce: { wait: 500, trailing: true } }
        });
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        (async () => {
            if (location.pathname === '/update-from-html') {
                let ready;
                while (!ready) {
                    ready = Array.from(document.querySelectorAll('div')).find(el => el.innerText === 'Ready!');
                    await delay(100);
                }
                const draymanElement = document.getElementsByTagName('drayman-element')[0];
                draymanElement.setAttribute('options', JSON.stringify({ text: 'Updated!' }));
            } else if (location.pathname === '/communication-ping') {
                let pongElement = document.createElement('drayman-element');
                pongElement.setAttribute('component', 'communication-pong');
                document.body.appendChild(pongElement);
            }
        })();
    </script>
</body>

</html>