"use strict";(self.webpackChunk_drayman_docs=self.webpackChunk_drayman_docs||[]).push([[1160],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return d}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),l=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},m=function(e){var n=l(e.components);return r.createElement(i.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),u=l(t),d=a,h=u["".concat(i,".").concat(d)]||u[d]||p[d]||o;return t?r.createElement(h,s(s({ref:n},m),{},{components:t})):r.createElement(h,s({ref:n},m))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,s=new Array(o);s[0]=u;var c={};for(var i in n)hasOwnProperty.call(n,i)&&(c[i]=n[i]);c.originalType=e,c.mdxType="string"==typeof e?e:a,s[1]=c;for(var l=2;l<o;l++)s[l]=t[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},9084:function(e,n,t){t.d(n,{Z:function(){return u}});var r=t(7294),a="browserWindow_25XZ",o="browserWindowHeader_KqAw",s="buttons_1hjc",c="browserWindowAddressBar_3kU8",i="dot_3vUt",l="browserWindowMenuIcon_62Vr",m="bar_1GUQ",p="browserWindowBody_2pXR";var u=function(e){var n=e.children,t=e.minHeight,u=e.url;return r.createElement("div",{className:a,style:{minHeight:t}},r.createElement("div",{className:o},r.createElement("div",{className:s},r.createElement("span",{className:i,style:{background:"#f25f58"}}),r.createElement("span",{className:i,style:{background:"#fbbe3c"}}),r.createElement("span",{className:i,style:{background:"#58cb42"}})),r.createElement("div",{className:c},u),r.createElement("div",{className:l},r.createElement("div",null,r.createElement("span",{className:m}),r.createElement("span",{className:m}),r.createElement("span",{className:m})))),r.createElement("div",{className:p},n))}},615:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return c},contentTitle:function(){return i},metadata:function(){return l},toc:function(){return m},default:function(){return u}});var r=t(7462),a=t(3366),o=(t(7294),t(3905)),s=(t(9084),["components"]),c={title:"The Server object",sidebar_position:7},i=void 0,l={unversionedId:"components-in-depth/helpers/the-server-object",id:"components-in-depth/helpers/the-server-object",isDocsHomePage:!1,title:"The Server object",description:"Drayman component instances live inside separate processes. They can communicate with each other via EventHub or browser using Browser object. But in some cases this won't be enough. For example, if you want to connect to the database, a database connection must be established during each component's initialization which will lead to a lot of overhead. Another example would be if some variable needs to be shared between all component instances.",source:"@site/docs/components-in-depth/helpers/the-server-object.mdx",sourceDirName:"components-in-depth/helpers",slug:"/components-in-depth/helpers/the-server-object",permalink:"/docs/components-in-depth/helpers/the-server-object",editUrl:"https://github.com/Claviz/drayman/blob/main/docs/docs/components-in-depth/helpers/the-server-object.mdx",version:"current",sidebarPosition:7,frontMatter:{title:"The Server object",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"The ComponentInstance object",permalink:"/docs/components-in-depth/helpers/the-component-instance-object"},next:{title:"Web Components in Drayman",permalink:"/docs/web-components/web-components-in-drayman"}},m=[{value:"Sharing data between all components centrally",id:"sharing-data-between-all-components-centrally",children:[{value:"Executing callbacks",id:"executing-callbacks",children:[]}]},{value:"Using EventHub",id:"using-eventhub",children:[]},{value:"Using middlewares and request interceptors",id:"using-middlewares-and-request-interceptors",children:[]}],p={toc:m};function u(e){var n=e.components,t=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Drayman component instances live inside separate processes. They can communicate with each other via ",(0,o.kt)("a",{parentName:"p",href:"./the-event-hub-object"},"EventHub")," or browser using ",(0,o.kt)("a",{parentName:"p",href:"./the-browser-object"},"Browser")," object. But in some cases this won't be enough. For example, if you want to connect to the database, a database connection must be established during each component's initialization which will lead to a lot of overhead. Another example would be if some variable needs to be shared between all component instances."),(0,o.kt)("p",null,"In another words, there must be a mechanism which stores data or executes some code in the main process and all component instances can access it. This mechanism is implemented by the Server object."),(0,o.kt)("p",null,"When Drayman starts, it searches for a ",(0,o.kt)("inlineCode",{parentName:"p"},"src/index.ts")," file. Inside of this file, it looks for an exported ",(0,o.kt)("inlineCode",{parentName:"p"},"Server")," function. This function is executed immediately and then all components can access it."),(0,o.kt)("h2",{id:"sharing-data-between-all-components-centrally"},"Sharing data between all components centrally"),(0,o.kt)("p",null,"Let's imagine we need to store some data in a central place and all components need to access it. We can do this by creating a ",(0,o.kt)("inlineCode",{parentName:"p"},"src/index.ts")," file with a function named ",(0,o.kt)("inlineCode",{parentName:"p"},"Server"),". This function will be executed when Drayman starts."),(0,o.kt)("p",null,"An object returned by this function can contain commands which are accessible by all components:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/index.ts"',title:'"src/index.ts"'},"export const Server: DraymanServer = async ({}) => {\n  let count = 0;\n\n  return {\n    increase: async () => {\n      count++;\n    },\n    getCount: async () => {\n      return count;\n    },\n  };\n};\n")),(0,o.kt)("p",null,"All these commands can be executed inside component script:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/components/home.tsx"',title:'"src/components/home.tsx"'},"export const component: DraymanComponent = async ({ forceUpdate, Server }) => {\n  const onBtnClick = async () => {\n    await Server.increase();\n    await forceUpdate();\n  };\n\n  return async () => {\n    let count = await Server.getCount();\n    return <button onclick={onBtnClick}>Times clicked: {count}</button>;\n  };\n};\n")),(0,o.kt)("p",null,"Even if browser is reloaded or another user tries to access or manipulate the data, this data won't be lost because it is stored in the main process."),(0,o.kt)("h3",{id:"executing-callbacks"},"Executing callbacks"),(0,o.kt)("p",null,"You can also execute callbacks in the main process. This can be useful if something needs to be done in background or after some time. For this, you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"emit")," function inside Server."),(0,o.kt)("p",null,"Let's create a command which will execute some action after a certain time:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/index.ts"',title:'"src/index.ts"'},"export const Server: DraymanServer = async ({ emit }) => {\n  return {\n    setTimeout: async ({ onAfterSomeTime }) => {\n      setTimeout(() => {\n        emit(onAfterSomeTime);\n      }, 1000);\n    },\n  };\n};\n")),(0,o.kt)("p",null,"You can then pass a callback from the component:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/components/home.tsx"',title:'"src/components/home.tsx"'},"export const component: DraymanComponent = async ({ forceUpdate, Server }) => {\n  const onBtnClick = async () => {\n    await Server.setTimeout({\n      onAfterSomeTime: async () => {\n        count++;\n        await forceUpdate();\n      },\n    });\n    await forceUpdate();\n  };\n\n  let count = 0;\n\n  return async () => {\n    return <button onclick={onBtnClick}>Times clicked: {count}</button>;\n  };\n};\n")),(0,o.kt)("h2",{id:"using-eventhub"},"Using EventHub"),(0,o.kt)("p",null,"Server object can also be used to listen to events from EventHub or emit events to EventHub. This can be used when you want to communicate from server to all or specific components at once. You can read more about EventHub object ",(0,o.kt)("a",{parentName:"p",href:"https://www.drayman.io/docs/components-in-depth/helpers/the-event-hub-object"},"here"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/index.ts"',title:'"src/index.ts"'},'export const Server: DraymanServer = async ({ EventHub }) => {\n  EventHub.on("my-event", (data) => {\n    console.log(data);\n  });\n\n  return {\n    sendEvent: async () => {\n      EventHub.emit("my-event", { hello: "world" });\n    },\n  };\n};\n')),(0,o.kt)("h2",{id:"using-middlewares-and-request-interceptors"},"Using middlewares and request interceptors"),(0,o.kt)("p",null,"Under the hood, Drayman launches simple Express.js server which is responsible for handling all incoming requests (for example, when user clicks a button). This server can be extended by adding middlewares or request interceptors to Express.js ",(0,o.kt)("inlineCode",{parentName:"p"},"app"),"."),(0,o.kt)("p",null,"This can become handy when you want to add some logic to all requests. For example, you can add some logging or authentication logic."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/index.ts"',title:'"src/index.ts"'},'export const Server: DraymanServer = async ({ app }) => {\n  app.use(async (req, res, next) => {\n    // log all requests to the console\n    console.log(`${req.method} ${req.url}`);\n\n    // set cookie for all requests\n    res.cookie("hello", "world");\n\n    next();\n  });\n};\n')),(0,o.kt)("p",null,"You can read more about Express.js middlewares and request interceptors ",(0,o.kt)("a",{parentName:"p",href:"https://expressjs.com/en/guide/using-middleware.html"},"here"),"."))}u.isMDXComponent=!0}}]);